name: Auto Frontend Snapshot
on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  snapshot:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: 3.11

      - name: Generate snapshot
        run: python snapshot_generator_frontend.py

      - name: Upload snapshot to repo (artifact)
        uses: actions/upload-artifact@v4
        with:
          name: frontend_snapshot
          path: frontend_snapshot.json

      - name: Trigger combined repo build
        env:
          TOKEN: ${{ secrets.COMBINE_REPO_TOKEN }}
        run: |
          echo "ðŸ“¡ Sending trigger event to combined repo..."
          REPO_OWNER="YOUR_GITHUB_USERNAME"   # ðŸ‘ˆ replace this
          COMBINED_REPO="billing-combined"    # ðŸ‘ˆ replace this
          API_URL="https://api.github.com/repos/$REPO_OWNER/$COMBINED_REPO/dispatches"

          curl -X POST -H "Accept: application/vnd.github+json" \
               -H "Authorization: Bearer $TOKEN" \
               -d '{"event_type": "frontend_snapshot_ready"}' \
               $API_URL

          echo "âœ… Trigger sent to combined repo"
